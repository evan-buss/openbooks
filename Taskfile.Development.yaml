# https://taskfile.dev

version: "3"

tasks:
  go-update:
    desc: Update Golang dependencies.
    cmds:
      - go get -u ./..
      - go mod tidy

  npm-update:
    desc: Update Node.JS client side dependencies.
    dir: server/app
    cmds:
      - npx npm-check-updates -i
    interactive: true

  npm-install:
    desc: Install Node.JS client side dependencies.
    dir: server/app
    cmds:
      - npm install
    sources:
      - package.json
      - package-lock.json

  irc:
    desc: Start IRC Server for Development
    cmds:
      - docker run --name ergo -d -p 6667:6667 -p 6697:6697 ghcr.io/ergochat/ergo:stable

  mock:
    desc: Start Mock Server for Development
    dir: cmd/mock
    cmds:
      - go run .

  cli:
    desc: Run OpenBooks in CLI Mode.
    dir: cmd/openbooks
    cmds:
      - go build
      - ./openbooks cli --tls=false --server localhost:6667 --name "dev-user"

  server:
    desc: Run OpenBooks in Server Mode.
    dir: cmd/openbooks
    cmds:
      - go build
      - ./openbooks server --tls=false --server localhost:6667 --name "dev-user"

  client:
    desc: Run OpenBooks React Client Application in Development Mode.
    dir: server/app
    cmds:
      - npm run dev

  desktop:
    desc: Run OpenBooks in the experimental desktop mode with a WebView GUI.
    dir: cmd/openbooks
    cmds:
      - go run -tags webview
